<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Short-term Rental Regulations Impact Analysis (2010-2024)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            margin-bottom: 30px;
        }
        .explanation {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-top: 20px;
        }
        .logo {
            max-width: 200px;
            margin: 0 auto 20px;
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="finmango.png" alt="FinMango Logo" class="logo">
        <h1>Short-term Rental Regulations Impact Analysis (2010-2024)</h1>
        <p>This analysis, prepared by <a href="https://sglasgow.com" target="_blank">Scott Glasgow</a> (<a href="https://finmango.org" target="_blank">FinMango</a>) for <a href="https://www.ivybusiness.iastate.edu/directory/czhang1/" target="_blank">Chen Zhang, PhD</a> (Iowa State University), examines Google search trends related to short-term rental regulations, income inequality, poverty, and local community impacts over a 15-year period.</p>
    </div>

    <div class="container">
        <h2>Understanding the Data</h2>
        <p>The data used in this analysis represents Google search query volumes for various terms related to short-term rentals, income inequality, poverty, and local community impacts from 2010 to 2024. Key points about the data:</p>
        <ul>
            <li><strong>Data Source:</strong> Exclusive access to Google Trends API, providing raw, non-normalized data.</li>
            <li><strong>Data Format:</strong> Values represent the probability of a search term multiplied by 10 million.</li>
            <li><strong>Geographical Scope:</strong> Data covers the entire United States.</li>
            <li><strong>Time Resolution:</strong> Monthly data points from 2010 to 2024.</li>
            <li><strong>Interpretation:</strong> Higher values indicate a greater probability of the term being searched relative to all US-based searches in that month.</li>
            <li><strong>Comparability:</strong> The non-normalized nature allows for direct comparison between different search terms and time periods.</li>
        </ul>
    </div>

    <div class="container">
        <h2>Short-term Rental Regulations and Housing Affordability</h2>
        <div class="chart-container">
            <canvas id="regulationsChart"></canvas>
        </div>
        <div class="explanation">
            <p>This chart shows the trends in search interest for short-term rental laws, Airbnb regulations, and affordable housing from 2010 to 2024. Key observations:</p>
            <ul>
                <li>Search interest in affordable housing has generally increased over the 15-year period, indicating growing public concern or awareness.</li>
                <li>Interest in short-term rental laws and Airbnb regulations began to appear in searches around 2015, with significant increases after 2020.</li>
                <li>The rise in searches for regulatory terms may reflect increasing public awareness of policy changes or debates surrounding short-term rentals.</li>
                <li>There appears to be a correlation between the rise in regulatory searches and affordable housing searches, suggesting a potential relationship between these topics in public discourse.</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2>Income Inequality and Poverty Trends</h2>
        <div class="chart-container">
            <canvas id="inequalityChart"></canvas>
        </div>
        <div class="explanation">
            <p>This chart illustrates the trends in search interest for income gap, wealth disparity, poverty rate, and economic inequality from 2010 to 2024. Key observations:</p>
            <ul>
                <li>Search interest in poverty rate has shown the highest overall level and variability among these terms.</li>
                <li>Interest in economic inequality and income gap have generally increased over time, particularly after 2020.</li>
                <li>Wealth disparity searches show a more modest increase but follow a similar trend to other inequality-related terms.</li>
                <li>These trends suggest growing public awareness or concern about economic disparities and poverty issues over the 15-year period.</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2>Local Community Impact</h2>
        <div class="chart-container">
            <canvas id="communityChart"></canvas>
        </div>
        <div class="explanation">
            <p>This chart shows the trends in search interest for neighborhood changes, community displacement, local business impact, and tourism effects from 2010 to 2024. Key observations:</p>
            <ul>
                <li>Search interest in local business impact and tourism effects has shown the most significant increase over time.</li>
                <li>Neighborhood changes and community displacement searches have remained relatively low but show a slight upward trend in recent years.</li>
                <li>The increase in these searches may reflect growing public awareness of the potential impacts of short-term rentals on local communities.</li>
                <li>The trends suggest that the economic aspects (business and tourism) of short-term rentals have garnered more public attention than social aspects (neighborhood changes and displacement).</li>
            </ul>
        </div>
    </div>

    <script>
    // Data will be loaded and processed here in the next part
    const data = [];

    // Function to process CSV data
    function processData(results) {
        results.data.forEach(row => {
            if (row.Date && row.Term && row.Value) {
                const date = new Date(row.Date);
                const year = date.getFullYear();
                const month = date.getMonth();
                const term = row.Term;
                const value = parseFloat(row.Value);

                let yearData = data.find(d => d.year === year);
                if (!yearData) {
                    yearData = { year: year };
                    data.push(yearData);
                }

                if (!yearData[term]) {
                    yearData[term] = new Array(12).fill(0);
                }
                yearData[term][month] = value;
            }
        });

        data.sort((a, b) => a.year - b.year);

        createCharts();
    }

    // Function to create charts
    function createCharts() {
        createRegulationsChart();
        createInequalityChart();
        createCommunityChart();
    }

    // Function to create Regulations Chart
    function createRegulationsChart() {
        const ctx = document.getElementById('regulationsChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => d.year),
                datasets: [
                    {
                        label: 'Short-term Rental Laws',
                        data: data.map(d => d['Short-term rental laws'] ? d['Short-term rental laws'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1
                    },
                    {
                        label: 'Airbnb Regulations',
                        data: data.map(d => d['Airbnb regulations'] ? d['Airbnb regulations'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1
                    },
                    {
                        label: 'Affordable Housing',
                        data: data.map(d => d['Affordable housing'] ? d['Affordable housing'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Average Annual Search Probability (x10^-7)'
                        }
                    }
                }
            }
        });
    }

    // Function to create Inequality Chart
    function createInequalityChart() {
        const ctx = document.getElementById('inequalityChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => d.year),
                datasets: [
                    {
                        label: 'Income Gap',
                        data: data.map(d => d['Income gap'] ? d['Income gap'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1
                    },
                    {
                        label: 'Wealth Disparity',
                        data: data.map(d => d['Wealth disparity'] ? d['Wealth disparity'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1
                    },
                    {
                        label: 'Poverty Rate',
                        data: data.map(d => d['Poverty rate'] ? d['Poverty rate'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    },
                    {
                        label: 'Economic Inequality',
                        data: data.map(d => d['Economic inequality'] ? d['Economic inequality'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(255, 159, 64)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Average Annual Search Probability (x10^-7)'
                        }
                    }
                }
            }
        });
    }

    // Function to create Community Impact Chart
    function createCommunityChart() {
        const ctx = document.getElementById('communityChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => d.year),
                datasets: [
                    {
                        label: 'Neighborhood Changes',
                        data: data.map(d => d['Neighborhood changes'] ? d['Neighborhood changes'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1
                    },
                    {
                        label: 'Community Displacement',
                        data: data.map(d => d['Community displacement'] ? d['Community displacement'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1
                    },
                    {
                        label: 'Local Business Impact',
                        data: data.map(d => d['Local business impact'] ? d['Local business impact'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    },
                    {
                        label: 'Tourism Effects',
                        data: data.map(d => d['Tourism effects'] ? d['Tourism effects'].reduce((a, b) => a + b, 0) / 12 : 0),
                        borderColor: 'rgb(255, 159, 64)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Average Annual Search Probability (x10^-7)'
                        }
                    }
                }
            }
        });
    }

    // Load and process the CSV data
    Papa.parse("combined_data.csv", {
        download: true,
        header: true,
        complete: processData
    });
    </script>
<div class="container">
        <h2>Correlation Analysis</h2>
        <div class="chart-container">
            <canvas id="correlationChart"></canvas>
        </div>
        <div class="explanation">
            <p>This heatmap shows the correlation between different search terms. Key observations:</p>
            <ul id="correlationObservations"></ul>
        </div>
    </div>

    <div class="container">
        <h2>Data Table</h2>
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Short-term Rental Laws</th>
                    <th>Airbnb Regulations</th>
                    <th>Affordable Housing</th>
                    <th>Income Gap</th>
                    <th>Wealth Disparity</th>
                    <th>Poverty Rate</th>
                    <th>Economic Inequality</th>
                    <th>Neighborhood Changes</th>
                    <th>Community Displacement</th>
                    <th>Local Business Impact</th>
                    <th>Tourism Effects</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be inserted here dynamically -->
            </tbody>
        </table>
    </div>

    <script>
    // Function to create Correlation Chart
    function createCorrelationChart() {
        const terms = ['Short-term rental laws', 'Airbnb regulations', 'Affordable housing', 'Income gap', 'Wealth disparity', 'Poverty rate', 'Economic inequality', 'Neighborhood changes', 'Community displacement', 'Local business impact', 'Tourism effects'];
        const correlationMatrix = calculateCorrelationMatrix(terms);

        const ctx = document.getElementById('correlationChart').getContext('2d');
        new Chart(ctx, {
            type: 'heatmap',
            data: {
                labels: terms,
                datasets: [{
                    data: correlationMatrix.flat().map((value, index) => ({
                        x: index % terms.length,
                        y: Math.floor(index / terms.length),
                        v: value
                    })),
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: (items) => {
                                const item = items[0];
                                return `${terms[item.parsed.x]} vs ${terms[item.parsed.y]}`;
                            },
                            label: (item) => `Correlation: ${item.parsed.v.toFixed(2)}`
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'category',
                        labels: terms,
                        ticks: {
                            display: false
                        }
                    },
                    y: {
                        type: 'category',
                        labels: terms,
                        offset: true,
                        ticks: {
                            display: true
                        }
                    }
                }
            }
        });

        // Add correlation observations
        const observations = document.getElementById('correlationObservations');
        correlationMatrix.forEach((row, i) => {
            row.forEach((value, j) => {
                if (i < j && Math.abs(value) > 0.5) {
                    const li = document.createElement('li');
                    li.textContent = `${terms[i]} and ${terms[j]} have a ${value > 0 ? 'positive' : 'negative'} correlation of ${value.toFixed(2)}.`;
                    observations.appendChild(li);
                }
            });
        });
    }

    // Function to calculate correlation matrix
    function calculateCorrelationMatrix(terms) {
        const matrix = [];
        for (let i = 0; i < terms.length; i++) {
            const row = [];
            for (let j = 0; j < terms.length; j++) {
                if (i === j) {
                    row.push(1);
                } else if (i < j) {
                    const correlation = calculateCorrelation(terms[i], terms[j]);
                    row.push(correlation);
                } else {
                    row.push(matrix[j][i]);
                }
            }
            matrix.push(row);
        }
        return matrix;
    }

    // Function to calculate correlation between two terms
    function calculateCorrelation(term1, term2) {
        const values1 = data.flatMap(d => d[term1] || []);
        const values2 = data.flatMap(d => d[term2] || []);
        const n = Math.min(values1.length, values2.length);

        let sum1 = 0, sum2 = 0, sum1Sq = 0, sum2Sq = 0, pSum = 0;
        for (let i = 0; i < n; i++) {
            sum1 += values1[i];
            sum2 += values2[i];
            sum1Sq += values1[i] ** 2;
            sum2Sq += values2[i] ** 2;
            pSum += values1[i] * values2[i];
        }

        const num = pSum - (sum1 * sum2 / n);
        const den = Math.sqrt((sum1Sq - sum1 ** 2 / n) * (sum2Sq - sum2 ** 2 / n));
        return num / den;
    }

    // Function to populate data table
    function populateDataTable() {
        const tableBody = document.querySelector('#dataTable tbody');
        const terms = ['Short-term rental laws', 'Airbnb regulations', 'Affordable housing', 'Income gap', 'Wealth disparity', 'Poverty rate', 'Economic inequality', 'Neighborhood changes', 'Community displacement', 'Local business impact', 'Tourism effects'];

        data.forEach(yearData => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${yearData.year}</td>`;
            terms.forEach(term => {
                const avgValue = yearData[term] ? (yearData[term].reduce((a, b) => a + b, 0) / 12).toFixed(2) : 'N/A';
                row.innerHTML += `<td>${avgValue}</td>`;
            });
            tableBody.appendChild(row);
        });
    }

    // Function to create all charts and populate the table
    function createCharts() {
        createRegulationsChart();
        createInequalityChart();
        createCommunityChart();
        createCorrelationChart();
        populateDataTable();
    }

    // Load and process the CSV data
    Papa.parse("combined_data.csv", {
        download: true,
        header: true,
        complete: processData
    });
    </script>
</body>
</html>
